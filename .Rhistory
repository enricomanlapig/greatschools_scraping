webpage %>%
html_elements("div.topical-item") %>%
html_element("div.topic-details") %>%
html_text() -> topic_rating_label
topic_rating_label <-
topic_rating_label[-grep("\\(", topic_rating_label)]
webpage %>%
html_elements("div.topical-item") %>%
html_element("div.topical-average") %>%
html_element("div.numeric") %>%
html_text() %>%
as.numeric() -> topic_rating
webpage %>%
html_elements("div.user-reviews-container") %>%
as.character() %>%
str_count('<div class="topical-item"') -> num_topic_ratings
webpage %>%
html_elements("div.user-reviews-container") %>%
as.character() %>%
str_count('<div class="topical-item"') -> num_topic_ratings
#### Function to extract topic ratings
review_index_ratings <- rep(1:length(num_topic_reviews), times = num_topic_ratings)
fn_extract_topic_rating <- function(my_topic) {
tmp <- rep(NA, times = length(review_date))
tmp[review_index_ratings[grep(my_topic, topic_rating_label)]] <-
topic_rating[grep(my_topic, topic_rating_label)]
return(tmp)
}
#### Extract topic ratings
homework_rating <- fn_extract_topic_rating("Homework")
teacher_rating <- fn_extract_topic_rating("Teachers")
character_rating <- fn_extract_topic_rating("Character")
leadership_rating <- fn_extract_topic_rating("Leadership")
bullying_rating <- fn_extract_topic_rating("Bullying")
learning_diffs_rating <- fn_extract_topic_rating("Learning Differences")
## Combine everything together in data frame
df_school_review <- data.frame(
school_name,
review_type,
review_date,
overall_rating,
overall_comments,
homework_rating,
teacher_rating,
character_rating,
leadership_rating,
bullying_rating,
learning_diffs_rating,
homework_comments,
teacher_comments,
character_comments,
leadership_comments,
bullying_comments,
learning_diffs_comments
)
while (length(remDr$findElements("link text", "More")) != 0) {
print("Found ", length(remDr$findElements("link text", "More")), " links to click. Clicking!", sep = "")
remDr$findElements("link text", "More")[[1]]$clickElement()
remDr$executeScript(paste("scroll(0,", i * 1080, ");"))
print("Scrolling down!")
Sys.sleep(1)
}
source('~/GitHub/greatschools_scraping/scrape_school_reviews.R', echo=TRUE)
for (s in 1:length(v_school_urls)) {
school_url <- v_school_urls[s]
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
paste("Scraping: ", school_url)
source("scrape_school_reviews.R")
if (s == 1) {
df_all_school_reviews <- df_school_review
} else{
df_all_school_reviews <- bind_rows(df_all_school_reviews,
df_school_review)
}
Sys.sleep(5)
}
while (length(remDr$findElements("link text", "More")) != 0) {
print(paste("Found", length(remDr$findElements("link text", "More")), "links to click. Clicking!"))
remDr$findElements("link text", "More")[[1]]$clickElement()
remDr$executeScript(paste("scroll(0,", i * 1080, ");"))
print("Scrolling down!")
Sys.sleep(1)
}
for (s in 1:length(v_school_urls)) {
school_url <- v_school_urls[s]
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
paste("Scraping: ", school_url)
source("scrape_school_reviews.R")
if (s == 1) {
df_all_school_reviews <- df_school_review
} else{
df_all_school_reviews <- bind_rows(df_all_school_reviews,
df_school_review)
}
Sys.sleep(5)
}
remDr$close()
rD$server$stop()
rm(rD)
school_reviews_outfile <- paste(city_name, "_reviews.RData")
city_name
school_reviews_outfile <- paste(city_name, "_reviews.RData")
school_reviews_outfile
school_reviews_outfile <- paste(city_name, "_reviews.RData", sep = "")
school_reviews_outfile
save(df_all_school_reviews, school_reviews_outfile)
save(df_all_school_reviews, file = school_reviews_outfile)
df_all_school_reviews
rD <- rsDriver(browser = "firefox",
verbose = F)
remDr <- rD[["client"]]
remDr$close()
rD$server$stop()
rm(rD)
rD <- rsDriver(browser = "firefox",
verbose = F)
rD <- rsDriver(browser = "firefox",
verbose = F)
overall_comments
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(RSelenium)
library(V8)
library(jsonlite)
library(stringr)
library(snakecase)
state_name <- "california"
#city_name <- "santa barbara" # 5 pages
#city_name <- "goleta" # 2 pages
city_name <- "summerland" # 1 page
city_name <- "montecito" # 1 page
city_name <- "carpinteria" # 1 page
city_name <- "ojai" # 2 pages
city_name <- "ventura" # 4 page
city_name <- "santa-ynez" # 1 page
city_name <- "solvang" # 1 pages
city_name <- "buellton" # 1 pages
city_name <- gsub(" ", "-", city_name)
school_list_url_left <- paste0("https://www.greatschools.org/",
state_name,
"/",
city_name,
"/schools/?page=",
sep = "")
#school_list_url_left <- "https://www.greatschools.org/california/santa-barbara/schools/?page="
school_list_url_right <- "&view=table"
school_list_js_xpath <- "/html/head/script[1]"
num_pages_to_scrape <- 1 # Check this by visiting the city page
source("scrape_school_lists.R")
school_list_outfile <- paste0(city_name, "_list.RData", sep = "")
save(df_schools, file = school_list_outfile)
school_url_left <- 'https://www.greatschools.org'
v_school_url_right <- df_schools$reviews
v_school_url_right <- gsub("#Reviews", "reviews/", v_school_url_right)
v_school_urls <- paste0(school_url_left, v_school_url_right)
v_school_urls <- setdiff(v_school_urls[df_schools$num_reviews > 0], NA)
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
rD <- rsDriver(browser = "firefox",
verbose = F)
remDr <- rD[["client"]]
remDr$open()
remDr$setWindowSize(width = 1920 / 2, height = 1080)
for (s in 1:length(v_school_urls)) {
school_url <- v_school_urls[s]
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
print(paste("Scraping: ", school_url))
source("scrape_school_reviews.R")
if (s == 1) {
df_all_school_reviews <- df_school_review
} else{
df_all_school_reviews <- bind_rows(df_all_school_reviews,
df_school_review)
}
Sys.sleep(5)
}
remDr$close()
rD$server$stop()
rm(rD)
school_reviews_outfile <- paste(city_name, "_reviews.RData", sep = "")
save(df_all_school_reviews, file = school_reviews_outfile)
paste(school_list_path, school_list_outfile, sep = "")
school_list_path <- "/data/"
paste(school_list_path, school_list_outfile, sep = "")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(RSelenium)
library(V8)
library(jsonlite)
library(stringr)
library(snakecase)
state_name <- "california"
#city_name <- "santa barbara" # 5 pages
#city_name <- "goleta" # 2 pages
city_name <- "summerland" # 1 page
city_name <- "montecito" # 1 page
city_name <- "carpinteria" # 1 page
city_name <- "ojai" # 2 pages
city_name <- "ventura" # 4 page
city_name <- "santa-ynez" # 1 page
city_name <- "solvang" # 1 pages
city_name <- "buellton" # 1 pages
city_name <- gsub(" ", "-", city_name)
school_list_url_left <- paste0("https://www.greatschools.org/",
state_name,
"/",
city_name,
"/schools/?page=",
sep = "")
#school_list_url_left <- "https://www.greatschools.org/california/santa-barbara/schools/?page="
school_list_url_right <- "&view=table"
school_list_js_xpath <- "/html/head/script[1]"
num_pages_to_scrape <- 1 # Check this by visiting the city page
source("scrape_school_lists.R")
school_url_left <- 'https://www.greatschools.org'
v_school_url_right <- df_schools$reviews
v_school_url_right <- gsub("#Reviews", "reviews/", v_school_url_right)
v_school_urls <- paste0(school_url_left, v_school_url_right)
v_school_urls <- setdiff(v_school_urls[df_schools$num_reviews > 0], NA)
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
rD <- rsDriver(browser = "firefox",
verbose = F)
num_pages_to_scrape <- 1 # Check this by visiting the city page
source("scrape_school_lists.R")
school_url_left <- 'https://www.greatschools.org'
v_school_url_right <- df_schools$reviews
v_school_url_right <- gsub("#Reviews", "reviews/", v_school_url_right)
v_school_urls <- paste0(school_url_left, v_school_url_right)
v_school_urls <- setdiff(v_school_urls[df_schools$num_reviews > 0], NA)
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
for (s in 1:length(v_school_urls)) {
school_url <- v_school_urls[s]
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
print(paste("Scraping: ", school_url))
source("scrape_school_reviews.R")
if (s == 1) {
df_all_school_reviews <- df_school_review
} else{
df_all_school_reviews <- bind_rows(df_all_school_reviews,
df_school_review)
}
Sys.sleep(5)
}
rD <- rsDriver(browser = "firefox",
verbose = F)
for (s in 1:length(v_school_urls)) {
school_url <- v_school_urls[s]
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
print(paste("Scraping: ", school_url))
source("scrape_school_reviews.R")
if (s == 1) {
df_all_school_reviews <- df_school_review
} else{
df_all_school_reviews <- bind_rows(df_all_school_reviews,
df_school_review)
}
Sys.sleep(5)
}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(RSelenium)
library(V8)
library(jsonlite)
library(stringr)
library(snakecase)
state_name <- "california"
#city_name <- "santa barbara" # 5 pages
#city_name <- "goleta" # 2 pages
#city_name <- "summerland" # 1 page
#city_name <- "montecito" # 1 page
#city_name <- "carpinteria" # 1 page
#city_name <- "ojai" # 2 pages
#city_name <- "ventura" # 4 page
#city_name <- "santa-ynez" # 1 page
#city_name <- "solvang" # 1 pages
city_name <- "buellton" # 1 pages
city_name <- gsub(" ", "-", city_name)
school_list_url_left <- paste0("https://www.greatschools.org/",
state_name,
"/",
city_name,
"/schools/?page=",
sep = "")
#school_list_url_left <- "https://www.greatschools.org/california/santa-barbara/schools/?page="
school_list_url_right <- "&view=table"
school_list_js_xpath <- "/html/head/script[1]"
num_pages_to_scrape <- 1 # Check this by visiting the city page
source("scrape_school_lists.R")
school_url_left <- 'https://www.greatschools.org'
v_school_url_right <- df_schools$reviews
v_school_url_right <- gsub("#Reviews", "reviews/", v_school_url_right)
v_school_urls <- paste0(school_url_left, v_school_url_right)
v_school_urls <- setdiff(v_school_urls[df_schools$num_reviews > 0], NA)
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
rD <- rsDriver(browser = "firefox",
verbose = F)
remDr <- rD[["client"]]
remDr$open()
remDr$setWindowSize(width = 1920 / 2, height = 1080)
for (s in 1:length(v_school_urls)) {
school_url <- v_school_urls[s]
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
print(paste("Scraping: ", school_url))
source("scrape_school_reviews.R")
if (s == 1) {
df_all_school_reviews <- df_school_review
} else{
df_all_school_reviews <- bind_rows(df_all_school_reviews,
df_school_review)
}
Sys.sleep(5)
}
remDr$close()
rD$server$stop()
rm(rD)
data_path <- "../data/"
school_list_outfile <- paste0(city_name, "_list.RData", sep = "")
save(df_schools, file = paste(data_path, school_list_outfile, sep = ""))
school_reviews_outfile <- paste(city_name, "_reviews.RData", sep = "")
save(df_all_school_reviews, file = paste(data_path, school_reviews_outfile, sep = ""))
remDr$close()
rD$server$stop()
rD$server$stop()
remDr$close()
remDr$server$stop()
knitr::opts_chunk$set(echo = TRUE)
rD <- rsDriver(browser = "phantomjs",
verbose = F)
library(tidyverse)
library(rvest)
library(RSelenium)
library(V8)
library(jsonlite)
library(stringr)
library(snakecase)
state_name <- "california"
#city_name <- "santa barbara" # 5 pages
#city_name <- "goleta" # 2 pages
#city_name <- "summerland" # 1 page
#city_name <- "montecito" # 1 page
#city_name <- "carpinteria" # 1 page
#city_name <- "ojai" # 2 pages
#city_name <- "ventura" # 4 page
#city_name <- "santa-ynez" # 1 page
#city_name <- "solvang" # 1 pages
city_name <- "buellton" # 1 pages
city_name <- gsub(" ", "-", city_name)
school_list_url_left <- paste0("https://www.greatschools.org/",
state_name,
"/",
city_name,
"/schools/?page=",
sep = "")
#school_list_url_left <- "https://www.greatschools.org/california/santa-barbara/schools/?page="
school_list_url_right <- "&view=table"
school_list_js_xpath <- "/html/head/script[1]"
num_pages_to_scrape <- 1 # Check this by visiting the city page
source("scrape_school_lists.R")
school_url_left <- 'https://www.greatschools.org'
v_school_url_right <- df_schools$reviews
v_school_url_right <- gsub("#Reviews", "reviews/", v_school_url_right)
v_school_urls <- paste0(school_url_left, v_school_url_right)
v_school_urls <- setdiff(v_school_urls[df_schools$num_reviews > 0], NA)
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
rD <- rsDriver(browser = "phantomjs",
verbose = F)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(RSelenium)
library(V8)
library(jsonlite)
library(stringr)
library(snakecase)
state_name <- "california"
#city_name <- "santa barbara" # 5 pages
#city_name <- "goleta" # 2 pages
#city_name <- "summerland" # 1 page
#city_name <- "montecito" # 1 page
#city_name <- "carpinteria" # 1 page
#city_name <- "ojai" # 2 pages
#city_name <- "ventura" # 4 page
#city_name <- "santa-ynez" # 1 page
#city_name <- "solvang" # 1 pages
city_name <- "buellton" # 1 pages
state_name <- "california"
#city_name <- "santa barbara" # 5 pages
#city_name <- "goleta" # 2 pages
#city_name <- "summerland" # 1 page
#city_name <- "montecito" # 1 page
#city_name <- "carpinteria" # 1 page
#city_name <- "ojai" # 2 pages
#city_name <- "ventura" # 4 page
#city_name <- "santa-ynez" # 1 page
#city_name <- "solvang" # 1 pages
city_name <- "buellton" # 1 pages
state_name <- "california"
#city_name <- "santa barbara" # 5 pages
#city_name <- "goleta" # 2 pages
#city_name <- "summerland" # 1 page
#city_name <- "montecito" # 1 page
#city_name <- "carpinteria" # 1 page
#city_name <- "ojai" # 2 pages
#city_name <- "ventura" # 4 page
#city_name <- "santa-ynez" # 1 page
#city_name <- "solvang" # 1 pages
city_name <- "buellton" # 1 pages
city_name <- gsub(" ", "-", city_name)
school_list_url_left <- paste0("https://www.greatschools.org/",
state_name,
"/",
city_name,
"/schools/?page=",
sep = "")
#school_list_url_left <- "https://www.greatschools.org/california/santa-barbara/schools/?page="
school_list_url_right <- "&view=table"
school_list_js_xpath <- "/html/head/script[1]"
num_pages_to_scrape <- 1 # Check this by visiting the city page
source("scrape_school_lists.R")
school_url_left <- 'https://www.greatschools.org'
v_school_url_right <- df_schools$reviews
v_school_url_right <- gsub("#Reviews", "reviews/", v_school_url_right)
v_school_urls <- paste0(school_url_left, v_school_url_right)
v_school_urls <- setdiff(v_school_urls[df_schools$num_reviews > 0], NA)
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
rD <- rsDriver(browser = "phantomjs",
verbose = F)
remDr <- rD[["client"]]
remDr$open()
for (s in 1:length(v_school_urls)) {
school_url <- v_school_urls[s]
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
print(paste("Scraping: ", school_url))
source("scrape_school_reviews.R")
if (s == 1) {
df_all_school_reviews <- df_school_review
} else{
df_all_school_reviews <- bind_rows(df_all_school_reviews,
df_school_review)
}
Sys.sleep(5)
}
remDr$open()
errorDetails
remDr$close()
rD$server$stop()
rm(rD)
rD <- rsDriver()
remDr$close()
rD$server$stop()
system("taskkill /im java.exe /f", intern=FALSE, ignore.stdout=FALSE)
remDr$close()
rD$server$stop()
system("taskkill /im java.exe /f", intern=FALSE, ignore.stdout=FALSE)
remDr$close()
rD$server$stop()
system("taskkill /im java.exe /f", intern=FALSE, ignore.stdout=FALSE)
rD <- rsDriver()
remDr <- rD[["client"]]
remDr$open()
remDr <- rD[["client"]]
remDr$open()
rD <- rsDriver()
remDr$close()
rD$server$stop()
system("taskkill /im java.exe /f", intern=FALSE, ignore.stdout=FALSE)
rD <- rsDriver()
remDr <- rD[["client"]]
remDr$open()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(RSelenium)
library(V8)
library(jsonlite)
library(stringr)
library(snakecase)
state_name <- "california"
#city_name <- "santa barbara" # 5 pages
#city_name <- "goleta" # 2 pages
#city_name <- "summerland" # 1 page
#city_name <- "montecito" # 1 page
#city_name <- "carpinteria" # 1 page
#city_name <- "ojai" # 2 pages
#city_name <- "ventura" # 4 page
#city_name <- "santa-ynez" # 1 page
#city_name <- "solvang" # 1 pages
city_name <- "buellton" # 1 pages
city_name <- gsub(" ", "-", city_name)
school_list_url_left <- paste0("https://www.greatschools.org/",
state_name,
"/",
city_name,
"/schools/?page=",
sep = "")
#school_list_url_left <- "https://www.greatschools.org/california/santa-barbara/schools/?page="
school_list_url_right <- "&view=table"
school_list_js_xpath <- "/html/head/script[1]"
num_pages_to_scrape <- 1 # Check this by visiting the city page
source("scrape_school_lists.R")
school_url_left <- 'https://www.greatschools.org'
v_school_url_right <- df_schools$reviews
v_school_url_right <- gsub("#Reviews", "reviews/", v_school_url_right)
v_school_urls <- paste0(school_url_left, v_school_url_right)
v_school_urls <- setdiff(v_school_urls[df_schools$num_reviews > 0], NA)
#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'
#rD <- rsDriver()
remDr <- remoteDriver(browserName = 'phantomjs')
#remDr <- rD[["client"]]
remDr$open()
