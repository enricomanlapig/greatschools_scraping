{
    "type": [
        2,
        2,
        0,
        1,
        3,
        3,
        0,
        1,
        3,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        3,
        0,
        1,
        2
    ],
    "data": [
        "\nR version 4.0.2 (2020-06-22) -- \"Taking Off Again\"\nCopyright (C) 2020 The R Foundation for Statistical Computing\nPlatform: x86_64-w64-mingw32/x64 (64-bit)\n\nR is free software and comes with ABSOLUTELY NO WARRANTY.\nYou are welcome to redistribute it under certain conditions.\nType 'license()' or 'licence()' for distribution details.\n\n  Natural language support but running in an English locale\n\nR is a collaborative project with many contributors.\nType 'contributors()' for more information and\n'citation()' on how to cite R or R packages in publications.\n\n",
        "Type 'demo()' for some demos, 'help()' for on-line help, or\n'help.start()' for an HTML browser interface to help.\nType 'q()' to quit R.\n\n[Workspace loaded from ~/GitHub/scraping/.RData]\n\n",
        "> ",
        "library(RSelenium)",
        "Warning message:\n",
        "package ‘RSelenium’ was built under R version 4.0.5 \n",
        "> ",
        "library(rvest)",
        "Warning message:\n",
        "package ‘rvest’ was built under R version 4.0.5 \n",
        "> ",
        "library(stringr)",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "#start RSelenium",
        "> ",
        "rD <- rsDriver(browser=\"firefox\", port=4545L, verbose=F)",
        "> ",
        "remDr <- rD[[\"client\"]]",
        "> ",
        "",
        "> ",
        "remDr$open()",
        "[1] \"Connecting to remote server\"\n$acceptInsecureCerts\n[1] FALSE\n\n$browserName\n[1] \"firefox\"\n\n$browserVersion\n[1] \"89.0.1\"\n\n$`moz:accessibilityChecks`\n[1] FALSE\n\n$`moz:buildID`\n[1] \"20210614221319\"\n\n$`moz:geckodriverVersion`\n[1] \"0.29.1\"\n\n$`moz:headless`\n[1] FALSE\n\n$`moz:processID`\n[1] 11432\n\n$`moz:profile`\n[1] \"C:\\\\Users\\\\emanlapig\\\\AppData\\\\Local\\\\Temp\\\\rust_mozprofilenLyiL7\"\n\n$`moz:shutdownTimeout`\n[1] 60000\n\n$`moz:useNonSpecCompliantPointerOrigin`\n[1] FALSE\n\n$`moz:webdriverClick`\n[1] TRUE\n\n$pageLoadStrategy\n",
        "[1] \"normal\"\n\n$platformName\n[1] \"windows\"\n\n$platformVersion\n[1] \"10.0\"\n\n$setWindowRect\n[1] TRUE\n\n$strictFileInteractability\n[1] FALSE\n\n$timeouts\n$timeouts$implicit\n[1] 0\n\n$timeouts$pageLoad\n[1] 300000\n\n$timeouts$script\n[1] 30000\n\n\n$unhandledPromptBehavior\n[1] \"dismiss and notify\"\n\n$webdriver.remote.sessionid\n[1] \"dc68d58e-5b57-4835-a510-3b25ad4deaaa\"\n\n$id\n[1] \"dc68d58e-5b57-4835-a510-3b25ad4deaaa\"\n\n",
        "> ",
        "remDr$setWindowSize(width = 1920/2, height = 1080)",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "#navigate to your page",
        "> ",
        "remDr$navigate(\"https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/\")",
        "> ",
        "",
        "> ",
        "#scroll down waiting for the page to load at each time",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "while(length(remDr$findElements(\"link text\", \"More\") ) != 0){",
        "+ ",
        "  print(length(remDr$findElements(\"link text\", \"More\") ))",
        "+ ",
        "  remDr$findElements(\"link text\", \"More\")[[1]]$clickElement()",
        "+ ",
        "  remDr$executeScript(paste(\"scroll(0,\",i*1080,\");\"))",
        "+ ",
        "  Sys.sleep(1)",
        "+ ",
        "}",
        "[1] 4\n",
        "Error in paste(\"scroll(0,\", i * 1080, \");\") : object 'i' not found\n",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "#get the page html",
        "> ",
        "webpage <- read_html(remDr$getPageSource()[[1]])",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "webpage %>%",
        "+ ",
        "  html_elements(\"div.static-container\") %>%",
        "+ ",
        "  html_element(\"div.container\") %>%",
        "+ ",
        "  html_element(\"a\") %>%",
        "+ ",
        "  html_text() -> school_name",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "webpage %>%",
        "+ ",
        "  html_elements(\"div.user-reviews-container\") %>%",
        "+ ",
        "  html_element(\"div.five-star-review\") %>%",
        "+ ",
        "  html_element(\"div.comment\") %>%",
        "+ ",
        "  html_text() -> overall_comments",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "webpage %>%",
        "+ ",
        "  html_elements(\"div.user-reviews-container\") %>%",
        "+ ",
        "  html_element(\"div.answer\") %>% ",
        "+ ",
        "  as.character() %>% ",
        "+ ",
        "  str_count(\"filled-star\") -> overall_rating",
        "> ",
        "  ",
        "> ",
        "webpage %>%",
        "+ ",
        "  html_elements(\"div.user-reviews-container\") %>%",
        "+ ",
        "  html_element(\"div.user-type\") %>%",
        "+ ",
        "  html_text() -> review_type",
        "> ",
        "",
        "> ",
        "webpage %>%",
        "+ ",
        "  html_elements(\"div.user-reviews-container\") %>%",
        "+ ",
        "  html_element(\"div.type-and-date\") %>%",
        "+ ",
        "  html_text() %>%",
        "+ ",
        "  as.Date(\"%B %d, %Y\") -> review_date",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "### Topic reviews",
        "> ",
        "",
        "> ",
        "webpage %>%",
        "+ ",
        "  html_elements(\"div.user-reviews-container\") %>%",
        "+ ",
        "  as.character() %>%",
        "+ ",
        "  str_count('<div class=\"topic\"') -> num_topic_reviews",
        "> ",
        "",
        "> ",
        "webpage %>%",
        "+ ",
        "  html_elements(\"div.topic\") %>%",
        "+ ",
        "  html_text() -> topic_labels",
        "> ",
        "",
        "> ",
        "webpage %>%",
        "+ ",
        "  html_elements(\"div.topical-review-detail\") %>%",
        "+ ",
        "  html_element(\"div.comment\") %>%",
        "+ ",
        "  html_text() -> topic_comments",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "### Function to extract topic comments",
        "> ",
        "",
        "> ",
        "review_index <- rep(1:length(num_topic_reviews), times = num_topic_reviews)",
        "> ",
        "",
        "> ",
        "fn_extract_topic_comments <- function(my_topic){",
        "+ ",
        "  tmp <- rep(NA, times = length(review_date))",
        "+ ",
        "  tmp[review_index[topic_labels == my_topic]] <- topic_comments[which(topic_labels == my_topic)]",
        "+ ",
        "  return(tmp)",
        "+ ",
        "}",
        "> ",
        "",
        "> ",
        "homework_comments <- fn_extract_topic_comments(\"Homework\")",
        "> ",
        "teacher_comments <- fn_extract_topic_comments(\"Teachers\")",
        "> ",
        "character_comments <- fn_extract_topic_comments(\"Character\")",
        "> ",
        "leadership_comments <- fn_extract_topic_comments(\"Leadership\")",
        "> ",
        "bullying_comments <- fn_extract_topic_comments(\"Bullying\")",
        "> ",
        "learning_diffs_comments <- fn_extract_topic_comments(\"Learning Differences\")",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "### Topic ratings",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "webpage %>%",
        "+ ",
        "  html_elements(\"div.topical-item\") %>%",
        "+ ",
        "  html_element(\"div.topic-details\") %>%",
        "+ ",
        "  html_text() -> topic_rating_label",
        "> ",
        "",
        "> ",
        "topic_rating_label <- topic_rating_label[-grep(\"\\\\(\", topic_rating_label)]",
        "> ",
        "",
        "> ",
        "webpage %>%",
        "+ ",
        "  html_elements(\"div.topical-item\") %>%",
        "+ ",
        "  html_element(\"div.topical-average\") %>%",
        "+ ",
        "  html_element(\"div.numeric\") %>%",
        "+ ",
        "  html_text() %>%",
        "+ ",
        "  as.numeric() -> topic_rating",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "webpage %>%",
        "+ ",
        "  html_elements(\"div.user-reviews-container\") %>%",
        "+ ",
        "  as.character() %>%",
        "+ ",
        "  str_count('<div class=\"topical-item\"') -> num_topic_ratings",
        "> ",
        "",
        "> ",
        "webpage %>%",
        "+ ",
        "  html_elements(\"div.user-reviews-container\") %>%",
        "+ ",
        "  as.character() %>%",
        "+ ",
        "  str_count('<div class=\"topical-item\"') -> num_topic_ratings",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "### Function to extract topic ratings",
        "> ",
        "",
        "> ",
        "review_index_ratings <- rep(1:length(num_topic_reviews), times = num_topic_ratings)",
        "> ",
        "",
        "> ",
        "fn_extract_topic_rating <- function(my_topic){",
        "+ ",
        "  tmp <- rep(NA, times = length(review_date))",
        "+ ",
        "  tmp[review_index_ratings[grep(my_topic, topic_rating_label)]] <- topic_rating[grep(my_topic, topic_rating_label)]",
        "+ ",
        "  return(tmp)",
        "+ ",
        "}",
        "> ",
        "",
        "> ",
        "homework_rating <- fn_extract_topic_rating(\"Homework\")",
        "> ",
        "teacher_rating <- fn_extract_topic_rating(\"Teachers\")",
        "> ",
        "character_rating <- fn_extract_topic_rating(\"Character\")",
        "> ",
        "leadership_rating <- fn_extract_topic_rating(\"Leadership\")",
        "> ",
        "bullying_rating <- fn_extract_topic_rating(\"Bullying\")",
        "> ",
        "learning_diffs_rating <- fn_extract_topic_rating(\"Learning Differences\")",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "",
        "> ",
        "### Combine together",
        "> ",
        "",
        "> ",
        "data.frame(",
        "+ ",
        "  school_name, review_date,",
        "+ ",
        "  overall_rating, overall_comments,",
        "+ ",
        "  homework_rating, teacher_rating, character_rating, leadership_rating, bullying_rating, learning_diffs_rating,",
        "+ ",
        "  homework_comments, teacher_comments, character_comments, leadership_comments, bullying_comments, learning_diffs_comments",
        "+ ",
        ")",
        "               school_name review_date overall_rating\n1 Crane Country Day School  2021-03-12              5\n2 Crane Country Day School  2020-08-26              5\n3 Crane Country Day School  2020-08-14              5\n4 Crane Country Day School  2020-02-19              1\n5 Crane Country Day School  2019-10-21              2\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     overall_comments",
        "\n1 Crane Country Day School is an amazing school. What we really love about the lower school at Crane are all the little extras that make it truly special. The emphasis and dedication to the fine and performing arts. The engaging and hands on lessons. The dedicated science and Spanish teachers. The math specialists. The experimental learning interwoven into every lesson. The sprawling campus and outdoor learning spaces. The diverse assortment of families from all over the area. The truly dedicated teachers. The personalized instruction afforded to each child. The wonderful head of school. Crane is second to none. We moved our children to Crane from a nearby public school and we couldn’t be happier with Crane, it’s very different from public school and exactly what we were hoping to provide for our children. It’s an expensive education but it’s been worth every penny for us because our children love going to school each day and they are really thriving.",
        "\n2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               We transferred our son into this school in 5th grade from another private school in town that was a horrible experience.  Bottom line, our son LOVES Crane.  He is happy and is excited about his education.... More ",
        "\n3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 My kids have absolutely loved their time at Crane. They are always happy at the end of the day and come home with the most amazing stories about what they did in class. Their teachers are just the best,... More ",
        "\n4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         I would not send my child to this school if I had the chance again. \\nWe tried for 3 years!",
        "\n5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Overall, Crane says the right things but does not practice them. They would benefit greatly from valuing practicing what they preach over just preaching.  The impression once you become more familiar with... More ",
        "\n  homework_rating teacher_rating character_rating leadership_rating bullying_rating learning_diffs_rating\n1               4            4.2              3.8               3.6             4.5                   4.3\n2               5            5.0              5.0               5.0             5.0                   5.0\n3               1            4.0              4.0               4.0             4.0                   5.0\n4               5            5.0              4.0               4.0             4.0                   5.0",
        "\n5               3            3.0              1.0               1.0             1.0                   4.0\n                                                                                                                                                                                        homework_comments\n1                                                                                                                                                                                                    <NA>\n2",
        "   Homework has been very stressful for our son.  It is totally unnecessary to place children under stress when the education they are receiving in the school itself is far above any other curriculum.\n3                                                                                                                                                                                                    <NA>\n4                                                                                      The school is good in the academic sense of the word, but the school has terrible policies when it comes to social",
        "\n5 It's unfortunate that the school has an overall policy for all classrooms instead of allowing teachers to use their knowledge of pedagogy and their students in order to make that decision themselves.\n                                                                                                                                                                                        teacher_comments\n1                                                                                                                                                                                                   <NA>",
        "\n2                                                                                                                                                     Like any school some are awesome some not so much.\n3 I love my kids' teachers! They are so creative, professional, and strong. My kids bring so many stories about how much their teachers care for them and how they've made the day so engaging. Love it!\n4                                                                                                                                                                                                   <NA>",
        "\n5               For the low pay and overall disrespect that the teachers are subjected to, I am surprised this school has been able to attract such effective teachers. The teachers here are wonderful.\n                                                                                                      character_comments\n1                                                                                                                   <NA>\n2                                            There are bullies. I feel that the school has handled most situations well.",
        "\n3                                                                                                                   <NA>\n4 The school is very biased towards families with more than one child and families who are established in the community.\n5      Crane does try to \"talk\" about character building although whether they show it in practice isn't the same story.\n                                                                                                             leadership_comments\n1                                                                                                                           <NA>",
        "\n2                                                   Joel is warm, understanding and ALWAYS interested in our family's wellbeing.\n3                                                                                                                           <NA>\n4                                                                                                                           <NA>\n5 Leadership seems much more interested in money than valuing their employees or the integrity and autonomy the classroom needs.",
        "\n                                                   bullying_comments\n1                                                               <NA>\n2                                                               <NA>\n3                                                               <NA>\n4 This school has the worst bullying policy you will ever encounter.\n5                                                               <NA>\n                                                                       learning_diffs_comments\n1                                                                                         <NA>",
        "\n2                                                                                         <NA>\n3                                                                                         <NA>\n4                                                                                         <NA>\n5 Students with learning differences have an extremely hard time thriving in this environment.\n",
        "> ",
        "knitr::opts_chunk$set(echo = TRUE)",
        "> ",
        "school_url_left <- 'https://www.greatschools.org/'",
        "> ",
        "",
        "> ",
        "v_school_url_right <- df_school_list$links$reviews",
        "Error: object 'df_school_list' not found\n",
        "> ",
        "knitr::opts_chunk$set(echo = TRUE)",
        "> ",
        "library(tidyverse)",
        "> ",
        "library(rvest)",
        "> ",
        "library(V8)",
        "> ",
        "library(jsonlite)",
        "> ",
        "library(stringr)",
        "> ",
        "school_list_url_left <- \"https://www.greatschools.org/california/santa-barbara/schools/?page=\"",
        "> ",
        "school_list_url_right <- \"&view=table\"",
        "> ",
        "school_list_js_xpath <- \"/html/head/script[1]\"",
        "> ",
        "source(\"scrape_school_lists.R\")",
        "[1] \"Scraping page 1\"\n[1] \"Scraping page 2\"\n",
        "> ",
        "school_url_left <- 'https://www.greatschools.org/'",
        "> ",
        "",
        "> ",
        "v_school_url_right <- df_school_list$links$reviews",
        "> ",
        "",
        "> ",
        "v_school_url_right <- gsub(\"#Reviews\", \"reviews/\", v_school_url_right)",
        "> ",
        "",
        "> ",
        "v_school_urls <- paste0(school_url_left, v_school_url_right)",
        "> ",
        "",
        "> ",
        "#school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'",
        "> ",
        "for(s in 1){",
        "+ ",
        "  school_url <- v_school_urls[s]",
        "+ ",
        "  #school_url <- 'https://www.greatschools.org/california/santa-barbara/11279-Crane-Country-Day-School/reviews/'",
        "+ ",
        "",
        "+ ",
        "  source(\"scrape_review_page.R\")",
        "+ ",
        "",
        "+ ",
        "    if (s == 1){",
        "+ ",
        "      df_all_school_reviews <- df_school_review",
        "+ ",
        "    } else{",
        "+ ",
        "      df_all_school_reviews <- rbind(df_all_school_reviews,",
        "+ ",
        "                                     df_school_review)",
        "+ ",
        "    }",
        "+ ",
        "    ",
        "+ ",
        "}",
        "Error in wdman::selenium(port = port, verbose = verbose, version = version,  : \n  Selenium server signals port = 4545 is already in use.\n",
        "> ",
        "remDr$close()",
        "Error: \t Summary: NoSuchDriver\n \t Detail: A session is either terminated or not started\n\t Further Details: run errorDetails method\n",
        "> ",
        "rm(rD)",
        "> ",
        "rD <- rsDriver(browser = \"firefox\",",
        "+ ",
        "               port = 4545L,",
        "+ ",
        "               verbose = F)",
        "Error in wdman::selenium(port = port, verbose = verbose, version = version,  : \n  Selenium server signals port = 4545 is already in use.\n",
        "> ",
        "rD$server$stop()",
        "Error: object 'rD' not found\n",
        "> ",
        "remDr$close()",
        "Error: \t Summary: NoSuchDriver\n \t Detail: A session is either terminated or not started\n\t Further Details: run errorDetails method\n",
        "> ",
        "rD$server$stop()",
        "Error: object 'rD' not found\n",
        "> ",
        "rm(rD)",
        "\nRestarting R session...\n\n"
    ]
}